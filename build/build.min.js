/*! build 2013-05-26 */
!function(a){var b=12,c="rgba(255, 255, 255, 0.0)",d=200,e=70,f=10,g=d/2+f,h=e/2+f+100;a.SimpleMessageWindow=tm.createClass({superClass:tm.app.Shape,init:function(a,f,i,j){this.superInit(d,e);var k=tm.app.Label(a+"",b);k.fillStyle=c,k.setAlign("left").setBaseline("top"),k.fontFamily="'Consolas', 'Monaco', 'ＭＳ ゴシック'",this.label=k,this.colorR=f||255,this.colorG=i||255,this.colorB=j||255,k.x=-this.width/2+10,k.y=-this.height/2+5,this.interaction.enabled=!1,this.alpha=0,this.backgroundColor="rgba(0, 0, 0, 0.0)";var l={is:!1};this.removeFlag=l,this.tweener.to({alpha:1e3},500).wait(5e3).to({alpha:-1},1e3).call(function(){l.is=!0}),this.addChild(k),this._refresh(),this.directX=g,this.directY=h},moveby:function(a,b){this.directX+=a/2,this.directY+=b/2,this.timeline.set({x:this.x,y:this.y},0).to({x:this.directX,y:this.directY},300,0|1e3*this.timeline.currentFrame/30)},update:function(){this._refresh(),this.removeFlag.is&&this.remove()},fillTextLine:function(a,b,c,d){var e=b.split("\n"),f=a.measureText("あ").width;e.forEach(function(b,e){a.fillText(b,c,d+f*e)})},_refresh:function(){var a=this.canvas;a.resize(this.width,this.width);var b=2;a.fillStyle=tm.graphics.Color.createStyleRGBA(this.colorR,this.colorG,this.colorB,.5*this.alpha/1e3),a.lineWidth=b,a.fillRoundRect(b,b,d-2*b,e-2*b,5),this.label.fillStyle=tm.graphics.Color.createStyleRGBA(20,20,20,this.alpha/1e3),this.label.setSize(this.width,this.height)}})}(game),function(a){var b=200,c=70,d=10,e=b/2+d,f=c/2+d+100;a.ManageSimpleWindows=tm.createClass({init:function(a){this.windowGroup=tm.app.CanvasElement(),a.addChild(this.windowGroup)},add:function(b,d,g,h){for(var i=0;i<this.windowGroup.children.length;++i)this.windowGroup.children[i].moveby(0,c);var j=a.SimpleMessageWindow(b,d,g,h);j.position.set(e,f),this.windowGroup.addChild(j)},update:function(){}})}(game),function(a){a.OnePlayAnimationSprite=tm.createClass({superClass:tm.app.AnimationSprite,init:function(a,b,c){this.superInit(c,a,b)},update:function(){this.isAnimation===!1&&this.remove()}})}(game),function(a){var b=32,c="rgba(255, 255, 255, 0.0)";a.DamagedNumber=tm.createClass({superClass:tm.app.Shape,init:function(a,d,e,f,g,h,i,j){var k=tm.app.Label(a+"",b);k.fillStyle=c,k.setAlign("center").setBaseline("middle"),k.fontFamily="'Diesel', 'Consolas', 'Monaco', 'ＭＳ ゴシック'",k.stroke=!0,k.lineWidth=1,this.label=k;var l=k.width+b,m=k.height+15;this.superInit(l,m),this.far=j||50,this.colorR=d||255,this.colorG=e||255,this.colorB=f||255,this.strokeColorR=g||0,this.strokeColorG=h||0,this.strokeColorB=i||0,k.x=0,k.y=-5,this.interaction.enabled=!1,this.alpha=1e3,this.backgroundColor="rgba(0, 0, 0, 0.0)",this.addChild(k),this._refresh()},effectPositionSet:function(a,b){a+=-10,b-=this.height/3,this.position.set(a,b),this.tweener.to({alpha:-1,x:a+this.far,y:b-this.far},700)},update:function(){this._refresh(),this.alpha<=0&&this.remove()},_refresh:function(){this.label.strokeStyle=tm.graphics.Color.createStyleRGBA(this.strokeColorR,this.strokeColorG,this.strokeColorB,this.alpha/1e3),this.label.fillStyle=tm.graphics.Color.createStyleRGBA(this.colorR,this.colorG,this.colorB,this.alpha/1e3),this.label.setSize(this.width,this.height)}})}(game),function(a){var b=30,c="rgba(20, 20, 20, 0.0)";a.Baloon=tm.createClass({superClass:tm.app.Shape,init:function(a,d,e,f,g){var h=tm.app.Label(a+"",b);h.fillStyle=c,h.setAlign("center").setBaseline("middle"),this.label=h;var i=h.width+b,j=h.height+15;this.superInit(i,j),this.far=g||50,this.colorR=d||255,this.colorG=e||255,this.colorB=f||255,h.x=0,h.y=-5,this.interaction.enabled=!1,this.alpha=1e3,this.backgroundColor="rgba(0, 0, 0, 0.0)",this.addChild(h),this._refresh()},effectPositionSet:function(a,b){a+=-10,b-=this.height/3,this.position.set(a,b),this.tweener.to({alpha:-1,x:a,y:b-this.far},700)},update:function(){this._refresh(),this.alpha<=0&&this.remove()},_refresh:function(){var a=this.canvas;a.resize(this.width,this.width);var b=0;a.fillStyle=tm.graphics.Color.createStyleRGBA(this.colorR,this.colorG,this.colorB,.5*this.alpha/1e3),a.lineWidth=0,a.fillRoundRect(b,b,this.width-2*b,this.height-2*b,5),this.label.fillStyle=tm.graphics.Color.createStyleRGBA(20,20,20,this.alpha/1e3),this.label.setSize(this.width,this.height)}})}(game),function(a){a.GlossyImageButton=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c,d){this.superInit(a,b),this.backgroundColor=d||"black",this.alpha=tm.app.GlossyButton.DEFAULT_ALPHA-.1,c.position.set(0,0),this.addChild(c),this.interaction.enabled=!0,this.interaction.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fade(.7,250)}),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.app.GlossyButton.DEFAULT_ALPHA-.1,250)}),this._refresh()},_refresh:function(){var a=this.canvas;a.resize(this.width,this.height),a.fillStyle=this.backgroundColor,a.fillCircle(this.width/2,this.height/2,this.width/2-20),a.strokeStyle="rgba(100,100,100,0.75)",a.lineWidth=2,a.strokeCircle(this.width/2,this.height/2,this.width/2);var b=tm.graphics.LinearGradient(0,0,0,this.height);b.addColorStop(0,"rgba(255,255,255,0.9)"),b.addColorStop(.5,"rgba(255,255,255,0.5)"),b.addColorStop(.51,"rgba(255,255,255,0.2)"),b.addColorStop(1,"rgba(255,255,255,0.0)"),a.setGradient(b),a.fillCircle(this.width/2,this.height/2,this.width/2-10)}})}(game),function(a){var b=4,c=2,d=b+2*c,e=0,f=1,g=function(a){for(var b="",c=0;c<a.length;++c){for(var d=0;d<a[c].length;++d)b+=a[c][d]?"#":".";console.log(b),b=""}};a.GenerateMap=tm.createClass({init:function(a,b){for(var c=[],d=0;b>d;++d){c[d]=[];for(var e=0;a>e;++e)c[d].push(!1)}this.map=c,this.rectList=[],this.roomList=[],this.coupleList=[],this._divideRect(this._addRect(0,0,a-1,b-1)),this._makeRoom(),this._makeMap(),g(this.map),this._arrange()},_arrange:function(){for(var a=0,b=this.map,c=[],d=0;d<b.length;++d){c[d]=[];for(var e=0;e<b[d].length;++e)b[d][e]?(b[d][e]=2,c[d].push(1),++a):(b[d][e]=1,c[d].push(0))}this.collision=c,this.walkMapNum=a},_makeMap:function(){for(var a=this.map,b=0;b<this.rectList.length;++b){break;var c}for(var b=0;b<this.roomList.length;++b)for(var d=this.roomList[b],g=d.lx;g<=d.hx;++g)for(var c=d.ly;c<=d.hy;++c)a[c][g]=!0;for(var b=0;b<this.coupleList.length;++b){var h=this.coupleList[b];switch(h.v_or_h){case f:var i=h.rect0.hx,j=Math.rand(h.rect0.room.ly+1,h.rect0.room.hy-1),k=h.rect1.lx,l=Math.rand(h.rect1.room.ly+1,h.rect1.room.hy-1);this._line(i,j,k,l),this._line(h.rect0.room.hx,j,i,j),this._line(h.rect1.room.lx,l,k,l);break;case e:var i=Math.rand(h.rect0.room.lx+1,h.rect0.room.hx-1),j=h.rect0.hy,k=Math.rand(h.rect1.room.lx+1,h.rect1.room.hx-1),l=h.rect1.ly;this._line(i,j,k,l),this._line(i,h.rect0.room.hy,i,j),this._line(k,h.rect1.room.ly,k,l)}}},_line:function(a,b,c,d){var e=c>a?a:c,f=a>c?a:c,g=d>b?b:d,h=b>d?b:d,i=this.map;if(c>=a&&b>=d){for(var j=e;f>=j;++j)i[g][j]=!0;for(var k=g;h>=k;++k)i[k][f]=!0}else if(a>c&&b>d){for(var j=e;f>=j;++j)i[g][j]=!0;for(var k=g;h>=k;++k)i[k][f]=!0}else if(a>c&&d>=b){for(var j=e;f>=j;++j)i[g][j]=!0;for(var k=g;h>=k;++k)i[k][e]=!0}else if(c>=a&&d>b){for(var j=e;f>=j;++j)i[h][j]=!0;for(var k=g;h>=k;++k)i[k][e]=!0}else;},_addRect:function(a,b,c,d){var e={lx:a,ly:b,hx:c,hy:d,room:{},done_split_v:!1,done_split_h:!1};return this.rectList.push(e),e},_divideRect:function(a){if(a.hy-a.ly<=2*d&&(a.done_split_v=!0),a.hx-a.lx<=2*d&&(a.done_split_h=!0),!a.done_split_v||!a.done_split_h){var b=this._addRect(a.lx,a.ly,a.hx,a.hy);if(Math.rand(0,1),!a.done_split_v){var c=Math.rand(a.ly+d,a.hy-d-1);return a.hy=c,b.ly=c,a.done_split_v=!0,b.done_split_v=!0,this._addCouple(e,a,b),this._divideRect(a),this._divideRect(b),void 0}if(!a.done_split_h){var g=Math.rand(a.lx+d,a.hx-d-1);return a.hx=g,b.lx=g,a.done_split_h=!0,b.done_split_h=!0,this._addCouple(f,a,b),this._divideRect(a),this._divideRect(b),void 0}}},_addRoom:function(a,b,c,d){var e={lx:a,ly:b,hx:c,hy:d,room:{}};return this.roomList.push(e),e},_makeRoom:function(){for(var a,d,e,f,g=0;g<this.rectList.length;++g){var h=this.rectList[g];e=Math.rand(b,h.hx-h.lx-2*c),f=Math.rand(b,h.hy-h.ly-2*c),a=Math.rand(h.lx+c,h.hx-c-e),d=Math.rand(h.ly+c,h.hy-c-f),h.room=this._addRoom(a,d,a+e,d+f)}},_addCouple:function(a,b,c){var d={v_or_h:a,rect0:b,rect1:c};return this.coupleList.push(d),d}})}(game),function(a){for(var b={circle:{},column:{},row:{},cross:{},plain:{}},c=["a","b","c","d"],d=0;4>d;++d)b.circle[c[d]]={},b.circle[c[d]].id=d+1,b.column[c[d]]={},b.column[c[d]].id=d+5,b.row[c[d]]={},b.row[c[d]].id=d+9,b.cross[c[d]]={},b.cross[c[d]].id=d+13,b.plain[c[d]]={},b.plain[c[d]].id=d+17;var e={a:[{pattern:[[1,1,-1],[1,1,-1],[-1,-1,-1]],tile:b.plain.a},{pattern:[[0,1,-1],[1,1,-1],[-1,-1,-1]],tile:b.cross.a},{pattern:[[-1,1,-1],[0,1,-1],[-1,-1,-1]],tile:b.column.a},{pattern:[[-1,0,-1],[1,1,-1],[-1,-1,-1]],tile:b.row.a},{pattern:[[-1,0,-1],[0,1,-1],[-1,-1,-1]],tile:b.circle.a}],b:[{pattern:[[-1,1,1],[-1,1,1],[-1,-1,-1]],tile:b.plain.b},{pattern:[[-1,1,0],[-1,1,1],[-1,-1,-1]],tile:b.cross.b},{pattern:[[-1,1,-1],[-1,1,0],[-1,-1,-1]],tile:b.column.b},{pattern:[[-1,0,-1],[-1,1,1],[-1,-1,-1]],tile:b.row.b},{pattern:[[-1,0,-1],[-1,1,0],[-1,-1,-1]],tile:b.circle.b}],c:[{pattern:[[-1,-1,-1],[1,1,-1],[1,1,-1]],tile:b.plain.c},{pattern:[[-1,-1,-1],[1,1,-1],[0,1,-1]],tile:b.cross.c},{pattern:[[-1,-1,-1],[0,1,-1],[-1,1,-1]],tile:b.column.c},{pattern:[[-1,-1,-1],[1,1,-1],[-1,0,-1]],tile:b.row.c},{pattern:[[-1,-1,-1],[0,1,-1],[-1,0,-1]],tile:b.circle.c}],d:[{pattern:[[-1,-1,-1],[-1,1,1],[-1,1,1]],tile:b.plain.d},{pattern:[[-1,-1,-1],[-1,1,1],[-1,1,0]],tile:b.cross.d},{pattern:[[-1,-1,-1],[-1,1,0],[-1,1,-1]],tile:b.column.d},{pattern:[[-1,-1,-1],[-1,1,1],[-1,0,-1]],tile:b.row.d},{pattern:[[-1,-1,-1],[-1,1,0],[-1,0,-1]],tile:b.circle.d}]};a.AutoTile=tm.createClass({init:function(a){this.from=1,this.map=a,this.isMatchOutMap=!1,this.autoTileMap=this.transformTile()},transformTile:function(){for(var a=[],b=0;b<this.map.length;++b){a[b]=[];for(var c=0;c<this.map[b].length;++c){var d=this.map[b][c];if(d===this.from){var e=this.checkPattern("a",this.map,b,c),f=this.checkPattern("b",this.map,b,c),g=this.checkPattern("c",this.map,b,c),h=this.checkPattern("d",this.map,b,c);a[b].push({tile:{a:e,b:f,c:g,d:h},mapChipId:d})}else a[b].push(d)}}return a},checkPattern:function(a,b,c,d){for(var f=e[a],g=0;g<f.length;++g){for(var h=!0,i=f[g].pattern,j=0;j<i.length;++j)for(var k=0;k<i[j].length;++k){if("undefined"!=typeof b[c+j-1])var l=b[c+j-1][d+k-1];else var l=null;var m=this._checkNeighborPattern(i[j][k],this.from,l);m||(h=!1)}if(h)return f[g].tile}console.log("auto tile error!: マップパターンのマッチングがおかしいです tileName : "+a+" index i : "+c+" index j : "+d),console.log(b[c-1][d-1]+" "+b[c-1][d]+" "+b[c-1][d+1]),console.log(b[c-0][d-1]+" "+b[c-0][d]+" "+b[c-0][d+1]),console.log(b[c+1][d-1]+" "+b[c+1][d]+" "+b[c+1][d+1])},_checkNeighborPattern:function(a,b,c){switch(("undefined"==typeof c||null===c)&&(c=this.isMatchOutMap?b:null),a){case-1:return!0;case 0:return b!==c?!0:!1;case 1:return b===c?!0:!1;default:return null}},get:function(){return this.autoTileMap}})}(game),function(a){var b=function(a){var b=0;for(var c in a)++b;return b};a.MapChip=tm.createClass({init:function(a){this.chips=a.chips,this.map=a.map,this.autotile=a.autotile,this.collision=a.collision,this.frames=[];var c=b(a.chips);this.images=[];for(var d=0;c>d;++d)this.images.push(tm.asset.AssetManager.get(a.chips[d].image)),this.images[d].loaded===!1?this.images[d].element.addEventListener("load",function(){this._calcFrames(d,a.chips)}.bind(this),!1):this._calcFrames(d,a.chips)},getMapChip:function(a,b){return this.frames[a][b]},_calcFrames:function(a,b){var c=b[a].width,d=b[a].height,e=~~(this.images[a].width/c),f=~~(this.images[a].height/d);this.frames[a]=[],b[a].count||(b[a].count=e*f);for(var g=0,h=b[a].count;h>g;++g){var i=g%e,j=0|g/e,k={x:i*c,y:j*d,width:c,height:d};this.frames[a].push(k)}}})}(game),function(a){a.MapSprite=tm.createClass({superClass:tm.app.Shape,init:function(a,b,c){var d=a.map[0].length*(b||16),e=a.map.length*(c||16);this.superInit(d,e),this.mapChipWidth=b||16,this.mapChipHeight=c||16,this.mapchip=a,this.currentFrame=0,this.currentFrameIndex=0,this.createMap()},createMap:function(){for(var a=0;a<this.mapchip.map.length;++a)for(var b=0;b<this.mapchip.map[a].length;++b)if("number"==typeof this.mapchip.autotile.autoTileMap[a][b]){var c=this.mapchip.map[a][b],d=this.mapchip.getMapChip(c,4),e=this.mapchip.images[c].element,f=b*this.mapChipWidth,g=a*this.mapChipHeight;this.canvas.drawImage(e,d.x,d.y,d.width,d.height,f,g,this.mapChipWidth,this.mapChipHeight)}else{var c=this.mapchip.map[a][b],e=this.mapchip.images[c].element,f=b*this.mapChipWidth,g=a*this.mapChipHeight,h=this.mapchip.autotile.autoTileMap[a][b].tile,i=h.a.id-1,j=h.b.id-1,k=h.c.id-1,l=h.d.id-1,d=this.mapchip.getMapChip(c,i);this.canvas.drawImage(e,d.x,d.y,d.width,d.height,f,g,this.mapChipWidth/2,this.mapChipHeight/2);var d=this.mapchip.getMapChip(c,j);this.canvas.drawImage(e,d.x,d.y,d.width,d.height,f+this.mapChipWidth/2,g,this.mapChipWidth/2,this.mapChipHeight/2);var d=this.mapchip.getMapChip(c,k);this.canvas.drawImage(e,d.x,d.y,d.width,d.height,f,g+this.mapChipHeight/2,this.mapChipWidth/2,this.mapChipHeight/2);var d=this.mapchip.getMapChip(c,l);this.canvas.drawImage(e,d.x,d.y,d.width,d.height,f+this.mapChipWidth/2,g+this.mapChipHeight/2,this.mapChipWidth/2,this.mapChipHeight/2)}},getBelong:function(a,b){var c=0|a/this.mapChipWidth,d=0|b/this.mapChipHeight,e={col:c,row:d,map:this.mapchip.map[d][c],collision:this.mapchip.collision[d][c]};return e},getCrossCollision:function(a,b){var c=this.mapchip.map.length-1,d=this.mapchip.map[0].length-1,e=b>0?this.mapchip.collision[b-1][a]:null,f=c>b?this.mapchip.collision[b+1][a]:null,g=a>0?this.mapchip.collision[b][a-1]:null,h=d>a?this.mapchip.collision[b][a+1]:null,i={up:e,down:f,left:g,right:h};return i},getRect:function(a,b){var c=b*this.mapChipHeight,d=(b+1)*this.mapChipHeight-1,e=a*this.mapChipWidth,f=(a+1)*this.mapChipWidth-1,g={up:c,down:d,left:e,right:f};return g}})}(game),function(a){var b=32,c=160,d=5,e=b,f=c/d,g=36,h=1,i=2,j=4,k=8;a.Map=tm.createClass({superClass:a.MapSprite,init:function(b){var c=Math.rand(20,31),d=a.GenerateMap(c,c),g=a.AutoTile(d.map),h=a.MapChip({chips:{0:{width:e,height:f,image:"Dirt1_pipo",count:5},1:{width:e/2,height:f/2,image:"Water2_pipo",count:20},2:{width:e,height:f,image:"Grass1_pipo",count:5}},map:d.map,autotile:g,collision:d.collision});this.superInit(h,64,64),this.walkMapNum=d.walkMapNum,this.isCreateSomething=[],this.velocity=tm.geom.Vector2(0,0),this.pad=b||!1,this.speed=0,this.isEnemy=!1,this.isPlayer=!1,this._isNextStage=!1},update:function(a){this._move(a),this._isHitTreasureBox(a),this._isHitStairs(a)},isNextStage:function(){return this._isNextStage},setStairs:function(){var a=tm.app.Sprite("stairs",64,64),b=this.getRandomSafeMapChipPosition();b=this.mapLeftTopToMapCenter(b.x*this.mapChipWidth+this.mapChipWidth/2,b.y*this.mapChipHeight),a.position.set(b.x,b.y+a.height/2),this.stairs=a,this.addChild(a)},setEnemyGroup:function(a){this.isEnemy=!0,this.enemyGroup=a,this.addChild(a),this.enemyDeadAnimationGroup=tm.app.CanvasElement(),this.addChild(this.enemyDeadAnimationGroup)},setEnemyDeadAnimation:function(a){this.enemyDeadAnimationGroup.addChild(a)},setItemGroup:function(a){this.itemGroup=a,this.addChild(a)},addItem:function(a){this.itemGroup.addChild(a)},setPlayer:function(b){this.isPlayer=!0,this.playerPosition=tm.geom.Vector2(this.width/2+(a.SCREEN_WIDTH/2-b.x),this.height/2+(a.SCREEN_HEIGHT/2-b.y)+g);var c=tm.app.Object2D();c.radius=20,this.playerElement=c},screenLeftTopToMapCenter:function(a,b){var c=tm.geom.Vector2(a-this.x,b-this.y);return c},screenLeftTopToMapLeftTop:function(a,b){var c=this.screenLeftTopToMapCenter(a,b),d=tm.geom.Vector2(c.x+this.width/2,c.y+this.height/2);return d},mapLeftTopToMapCenter:function(a,b){var c=tm.geom.Vector2(-this.width/2+a,-this.height/2+b);return c},mapCenterToMapLeftTop:function(a,b){var c=tm.geom.Vector2(this.width/2+a,this.height/2+b);return c},mapCenterToScreenTopLeft:function(a,b){var c=tm.geom.Vector2(this.x+a,this.y+b);return c},mapLeftTopToScreenTopLeft:function(a,b){var c=this.mapLeftTopToMapCenter(a,b),d=this.mapCenterToScreenTopLeft(c.x,c.y);return d},initMapPosition:function(a){this.initPosition=tm.geom.Vector2(a.x,a.y),this.position.set(a.x,a.y)},getRandomSafeMapChipPosition:function(){for(var a=Math.rand(0,this.walkMapNum-1),b=!0;;){for(var c=0;c<this.isCreateSomething.length;++c){if(this.isCreateSomething[c]===a){a=Math.rand(0,this.walkMapNum-1),b=!1;break}b=!0}if(b&&this.isCreateSomething[c]!==a)break}for(var d=0,c=0;c<this.mapchip.collision.length;++c)for(var e=0;e<this.mapchip.collision[c].length;++e)if(1===this.mapchip.collision[c][e]){if(d===a){var f={x:e,y:c};return this.isCreateSomething.push(d),f}++d}},_move:function(a){var b=0;this.isPlayer&&a.currentScene.player&&(b=a.currentScene.player.getSpeed());var c=a.keyboard.getKeyAngle();if(null!==c)this.velocity.setDegree(c,1),this.velocity.x*=-1,this.speed=b||6;else if(this.pad&&this.pad.isTouching){var d=this.pad.angle;0>d?d*=-1:d=360-d,this.velocity.setDegree(d,1),this.velocity.x*=-1,this.speed=b||6}this.isPlayer&&(this.velocity=this._playerMove()),this.isEnemy&&this._enemyMove(),this.position.add(tm.geom.Vector2.mul(this.velocity,this.speed)),this.speed=0},_enemyMove:function(){for(var a=0;a<this.enemyGroup.children.length;++a){var b=this.enemyGroup.children[a].velocity.clone(),c=this.enemyGroup.children[a].position.clone();c=this.mapCenterToMapLeftTop(c.x,c.y);var d=this.enemyGroup.children[a].speed;b.x*=-1,b.y*=-1;var e=this._isHitCollisionMap(c.x,c.y,b,d);e&h&&(b.y=0),e&i&&(b.y=0),e&j&&(b.x=0),e&k&&(b.x=0),this.enemyGroup.children[a].position.add(tm.geom.Vector2.mul(b,d))}},_playerMove:function(){var a=this.velocity.clone();a.x*=-1,a.y*=-1;var b=this._isHitCollisionMap(this.playerPosition.x,this.playerPosition.y,a,this.speed);return b&h&&(a.y=0),b&i&&(a.y=0),b&j&&(a.x=0),b&k&&(a.x=0),this.playerPosition.add(tm.geom.Vector2.mul(a,this.speed)),a.x*=-1,a.y*=-1,a.clone()},_isHitCollisionMap:function(a,b,c,d){var e=0,f=this.getBelong(a,b),g=this.getRect(f.col,f.row),l=this.getCrossCollision(f.col,f.row),m=tm.geom.Vector2.mul(c,d);if(null===l.up||0===l.up){var n=b+m.y;n<g.up&&(e|=h)}if(null===l.down||0===l.down){var n=b+m.y;n>g.down&&(e|=i)}if(null===l.left||0===l.left){var o=a+m.x;o<g.left&&(e|=j)}if(null===l.right||0===l.right){var o=a+m.x;o>g.right&&(e|=k)}return e},_isHitTreasureBox:function(a){if(this.isPlayer){var b=this.itemGroup.children,c=this.mapLeftTopToMapCenter(this.playerPosition.x,this.playerPosition.y);this.playerElement.position.set(c.x,c.y);for(var d=0;d<b.length;++d){b[d].position.clone();var e=b[d].isHit(this.playerElement);if(null!==e){a.currentScene.windows.add(e.name+" を手に入れた");var f=a.currentScene.getChildByName("player");f.addItem(e),tm.asset.AssetManager.get("openTreasure").clone().play()}}}},_isHitStairs:function(){if(this.isPlayer){var a=this.mapLeftTopToMapCenter(this.playerPosition.x,this.playerPosition.y);this.playerElement.position.set(a.x,a.y),this.stairs.isHitElementCircle(this.playerElement)&&(this._isNextStage=!0)}}})}(game),function(a){var b=1,c=19,d=7,e=13,f=16,g=22,h=4,i=10,j=180,k=135,l=90,m=45,n=0,o=315,p=270,q=225,r=120,s=112,t=6,u=4,v=24;a.AnimationCharactor=tm.createClass({superClass:tm.app.AnimationSprite,init:function(a,j,k){j=j||{width:r/t,height:s/u,count:v},k=k||4;var l=tm.app.SpriteSheet({image:a,frame:j,animations:{onlydown:{frames:[b,b+1,b,b-1],next:"onlydown",frequency:5},onlyup:{frames:[c,c+1,c,c-1],next:"onlyup",frequency:5},onlyleft:{frames:[d,d+1,d,d-1],next:"onlyleft",frequency:5},onlyright:{frames:[e,e+1,e,e-1],next:"onlyright",frequency:5},upleft:{frames:[f,f+1,f,f-1],next:"upleft",frequency:5},upright:{frames:[g,g+1,g,g-1],next:"upright",frequency:5},downleft:{frames:[h,h+1,h,h-1],next:"downleft",frequency:5},downright:{frames:[i,i+1,i,i-1],next:"downright",frequency:5}}});this.superInit(l,j.width*k,j.height*k),this.velocity=tm.geom.Vector2(0,0),this.isAnimation=!0,this.isInput=!1,this.isAuto=!1,this.pad=!1,this.angle=270,this.speed=6},setInputPad:function(a){this.pad=a||!1},directWatch:function(a){this._exceptDirectWatch(a)&&(a>p-22.5&&p+22.5>=a?this.gotoAndPlay("onlydown"):a>q-22.5&&q+22.5>=a?this.gotoAndPlay("downleft"):a>j-22.5&&j+22.5>=a?this.gotoAndPlay("onlyleft"):a>k-22.5&&k+22.5>=a?this.gotoAndPlay("upleft"):a>l-22.5&&l+22.5>=a?this.gotoAndPlay("onlyup"):a>m-22.5&&m+22.5>=a?this.gotoAndPlay("upright"):a>o+22.5||n+22.5>=a?this.gotoAndPlay("onlyright"):a>o-22.5&&o+22.5>=a&&this.gotoAndPlay("downright"))},inputAnimation:function(a){if(this.isInput){var b=a.keyboard.getKeyAngle();if(null!==b&&this.isAnimation)this.velocity.setDegree(b,1),this.velocity.y*=-1,this.directWatch(b),this.angle=b;else if(this.pad&&this.pad.isTouching){var c=this.pad.angle;0>c?c*=-1:c=360-c,this.velocity.setDegree(c,1),this.velocity.y*=-1,this.directWatch(c),this.angle=c}else this.paused=!0}},_exceptDirectWatch:function(a){return this.currentAnimation?-1!==this.currentAnimation.next.indexOf("onlydown",0)?a>p-22.5&&p+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("downleft",0)?a>q-22.5&&q+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("onlyleft",0)?a>j-22.5&&j+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("upleft",0)?a>k-22.5&&k+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("onlyup",0)?a>l-22.5&&l+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("upright",0)?a>m-22.5&&m+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("onlyright",0)?a>o+22.5||n+22.5>=a?(this.paused=!1,!1):!0:-1!==this.currentAnimation.next.indexOf("downright",0)?a>o-22.5&&o+22.5>=a?(this.paused=!1,!1):!0:void 0:!0}})}(game),function(a){a.Player=tm.createClass({superClass:a.AnimationCharactor,init:function(){this.name="player",this.superInit("player",{width:20,height:28,count:24},3),this.isInput=!0,this._isGameOver=!1,this.level=1,this.maxhp=30,this.hp=30,this.maxmp=10,this.mp=10,this._str=1,this._def=1,this._agi=4,this._luk=1,this._vit=1,this._dex=1,this._aspd=190,this.speed=5,this.exp=0,this.nextLevelExp=8,this.item=[],this.equipedWeapon=null,this.equipedArmor=null},getLevel:function(){return this.level},getMaxHP:function(){return this.maxhp},getCurrentHP:function(){return this.hp},getMaxMP:function(){return this.maxmp},getCurrentMP:function(){return this.mp},getSTR:function(){return this._str},getDEF:function(){return this._def},getAGI:function(){return this._agi},getLUK:function(){return this._luk},getVIT:function(){return this._vit},getDEX:function(){return this._dex},getEXP:function(){return this.exp},getNextLevel:function(){return this.nextLevelExp},isGameOver:function(){return this._isGameOver},cloneToSave:function(){for(var a=function(a){if(null===a)return null;var b={name:a.name,type:a.type,summary:a.summary,dropImage:a.dropImage,status:{hp:a.status.hp,dis:a.status.dis,agi:a.status.agi,def:a.status.def,dex:a.status.dex,luk:a.status.luk,str:a.status.str,vit:a.status.vit}};return b},b={level:this.level,maxhp:this.maxhp,hp:this.hp,maxmp:this.maxmp,mp:this.mp,_str:this._str,_def:this._def,_agi:this._agi,_luk:this._luk,_vit:this._vit,_dex:this._dex,_aspd:this._aspd,speed:this.speed,exp:this.exp,nextLevelExp:this.nextLevelExp,item:[],equipedWeapon:a(this.equipedWeapon),equipedArmor:a(this.equipedArmor)},c=0;c<this.item.length;++c)b.item.push(a(this.item[c]));return b},dataLoad:function(a){this.level=a.level,this.maxhp=a.maxhp,this.hp=a.hp,this.maxmp=a.maxmp,this.mp=a.mp,this._str=a._str,this._def=a._def,this._agi=a._agi,this._luk=a._luk,this._vit=a._vit,this._dex=a._dex,this._aspd=a._aspd,this.speed=a.speed,this.exp=a.exp,this.nextLevelExp=a.nextLevelExp,this.item=a.item,this.equipedWeapon=a.equipedWeapon,this.equipedArmor=a.equipedArmor,console.dir(this)},getSpeed:function(){return this.speed+(0|this.getLastAGI()/2)},getLastAGI:function(){var a=this.getAGI();return null!==this.equipedWeapon&&(a+=this.equipedWeapon.status.agi),null!==this.equipedArmor&&(a+=this.equipedArmor.status.agi),a},getAttackSpeed:function(a){var b=this._aspd+Math.sqrt(15e4*this.getLastAGI()+9*this.getDEX()/49);return a/(b/150)},getDistanse:function(){return null!==this.equipedWeapon?this.equipedWeapon.status.dis:0},eatMedicine:function(a){a.status&&(this.hp+=a.status.hp||0,tm.asset.AssetManager.get("eat").clone().play(),this.hp>this.maxhp&&(this.hp=this.maxhp))},levelUp:function(a){this.maxhp+=Math.rand(0,10),this.maxmp+=Math.rand(0,5),this._str+=Math.rand(0,2),this._def+=Math.rand(0,2),this._agi+=0===Math.rand(0,8)?1:0,this._luk+=Math.rand(0,2),this._vit+=Math.rand(0,2),this._dex+=Math.rand(0,2),this.hp=this.maxhp,this.mp=this.maxmp,tm.asset.AssetManager.get("levelup").clone().play(),a.currentScene.windows.add("レベルが"+this.level+"に上がった",255,255,30)},addExp:function(a,b){this.exp+=a,this.exp>=this.nextLevelExp&&(++this.level,this.nextLevelExp=Math.ceil(1.4*this.nextLevelExp),this.levelUp(b),this.addExp(0))},addItem:function(a){this.item.push(a)},getItem:function(){return this.item},deleteItem:function(a){this.item.splice(a,1)},equipWeapon:function(a){a?(this.equipedWeapon=a,tm.asset.AssetManager.get("equip").clone().play()):this.equipedWeapon=null},getWeapon:function(){if(null===this.equipedWeapon){var a={dropImage:null,name:"装備無し",status:{dis:0,str:0,def:0,agi:0,luk:0,vit:0,dex:0}};return a}return this.equipedWeapon},equipArmor:function(a){a?(this.equipedArmor=a,tm.asset.AssetManager.get("equip").clone().play()):this.equipedArmor=null},getArmor:function(){if(null===this.equipedArmor){var a={dropImage:null,name:"装備無し",status:{str:0,def:0,agi:0,luk:0,vit:0,dex:0}};return a}return this.equipedArmor},getAttackPoint:function(){var a=Math.rand(9,11)/10,b=0|(this._str+this._dex/5+this._luk/3)*a;return b+=this.getWeapon().status.str+this.getArmor().status.str},damage:function(a){var b=0|a-this._def-this.getWeapon().status.def-this.getArmor().status.def;return b=0>b?0:b,this.hp-=b,this.hp=this.hp<0?0:this.hp,this.hp<=0&&(this._isGameOver=!0,tm.asset.AssetManager.get("playerdown").clone().play()),b},attack:function(){return tm.asset.AssetManager.get("enemydamage").clone().play(),this.angle},update:function(a){this.inputAnimation(a)}})}(game),function(a){var b=90;a.Enemy=tm.createClass({superClass:a.AnimationCharactor,init:function(a,b,c,d,e){this.superInit(a,b,c),this.isInput=!1,this.isAuto=!0,this.maxhp=0,this.hp=0,this.maxmp=0,this.mp=0,this._str=0,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=0,this.speed=0,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"ナイフ",random:2}],this.map=e,this.player=d,this.lengthToPlayer=0,this.lengthToAttack=50,this.lengthToActive=150,this.lengthToSense=300,this.modeActive=0,this.modeSafe=0,this.attackTime=0;var f=tm.app.SpriteSheet({image:"slash",frame:{width:65,height:65,count:8},animations:{slash:[0,8]}}),g=tm.app.AnimationSprite(f,120,120);g.position.set(0,0),this.slash=g,this.attackDistanse=50,this.addChild(g)},getMaxHP:function(){return this.maxhp},getCurrentHP:function(){return this.hp},getMaxMP:function(){return this.maxmp},getCurrentMP:function(){return this.mp},getAttackPoint:function(){var a=Math.rand(9,11)/10,b=0|(this._str+this._dex/5+this._luk/3)*a;return b},damage:function(a){var b=0|a-this._def;return b=0>b?0:b,this.hp-=b,this.hp=this.hp<0?0:this.hp,b},getExp:function(){return this.hp<=0?this.exp:0},getDropItem:function(){if(this.hp<=0)for(var a=0;a<this.dropItemList.length;++a)if(0===Math.rand(0,this.dropItemList[a].random))return this.dropItemList[a].itemName;return null},isEnemyDead:function(){return this.hp<=0?(tm.asset.AssetManager.get("enemydown").clone().play(),this.remove(),!0):!1},isHit:function(){},update:function(a){if(this.isAuto){var b=this.position.clone();b=this.map.mapCenterToMapLeftTop(b.x,b.y),b.y+=35;var c=this.map.playerPosition.distance(b);c<=this.lengthToAttack?(this._moveAttack(),this._attack(a,b,this.map.playerPosition.clone()),++this.attackTime):c<=this.lengthToActive?(this._moveActive(b,this.map.playerPosition.clone()),++this.attackTime):c<=this.lengthToSense&&(this._moveSense(a),this.attackTime=0)}},_attack:function(c,d,e){if(!(this.attackTime<b)){this.attackTime=b,e.sub(d);var f=e.normalize(),g=this.attackDistanse,h=tm.geom.Vector2.mul(f,g);this.slash.position.set(h.x,h.y),this.slash.gotoAndPlay("slash"),tm.asset.AssetManager.get("playerdamage").clone().play();var i=this.position.clone().add(h);i=this.map.mapCenterToMapLeftTop(i.x,i.y-20);var j=tm.app.Object2D();j.radius=40,j.position.set(i.x,i.y);var k=tm.app.Object2D();if(k.radius=40,k.position.set(this.map.playerPosition.x,this.map.playerPosition.y),k.isHitElementCircle(j)){this.attackTime=0;var l=this.getAttackPoint(),m=this.player.damage(l),n=a.DamagedNumber(m,255,20,20,255,255,255);this.map.mapCenterToScreenTopLeft(k.x,k.y),n.effectPositionSet(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT/2+10),c.currentScene.addChild(n)}}},_moveAttack:function(){this.velocity.x=0,this.velocity.y=0},_moveActive:function(a,b){b.sub(a),this.velocity=b.normalize(),this.velocity.x*=-1,this.velocity.y*=-1;var c=Math.radToDeg(this.velocity.toAngle());c-=180,0>c?c*=-1:c=360-c,this.directWatch(c)},_moveSense:function(a){if(0===a.frame%20)var b=Math.rand(0,359);b&&this.isAnimation&&(this.velocity.setDegree(b,1),this.velocity.x*=-1,this.directWatch(b))}})}(game),function(a){a.SlimeBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SlimeBlue",{width:16,height:20,count:24},3,a,b),this.maxhp=70,this.hp=70,this.maxmp=0,this.mp=0,this._str=12,this._def=10,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=4,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"モンスターの液体",random:3},{itemName:"ポーション",random:9},{itemName:"布の鎧",random:6}]}})}(game),function(a){a.SlimeGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SlimeGreen",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=1,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"雑草",random:2},{itemName:"モンスターの液体",random:2},{itemName:"布の服",random:2}]}})}(game),function(a){a.SlimeRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SlimeRed",{width:16,height:20,count:24},3,a,b),this.maxhp=180,this.hp=180,this.maxmp=0,this.mp=0,this._str=21,this._def=-10,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=15,this.speed=5,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"モンスターの液体",random:3},{itemName:"ポーション",random:3}]}})}(game),function(a){a.SlimeGold=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SlimeGold",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.SmallBatBlack=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SmallBatBlack",{width:20,height:24,count:24},3,a,b),this.maxhp=10,this.hp=10,this.maxmp=0,this.mp=0,this._str=5,this._def=1,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=1,this.speed=5,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"ナイフ",random:3},{itemName:"肉",random:6},{itemName:"布の服",random:6}]}})}(game),function(a){a.SmallBatGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SmallBatGreen",{width:20,height:24,count:24},3,a,b),this.maxhp=40,this.hp=40,this.maxmp=0,this.mp=0,this._str=12,this._def=10,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=5,this.speed=5,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"レイピア",random:4},{itemName:"布の鎧",random:3}]}})}(game),function(a){a.SmallBatRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SmallBatRed",{width:20,height:24,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]
}})}(game),function(a){a.SmallBatGhost=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SmallBatGhost",{width:20,height:24,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GoblinGrey=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GoblinGrey",{width:18,height:18,count:24},3,a,b),this.maxhp=20,this.hp=32,this.maxmp=0,this.mp=0,this._str=10,this._def=3,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=2,this.speed=2,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"サーベル",random:5},{itemName:"ダガー",random:8},{itemName:"布の服",random:3}]}})}(game),function(a){a.GoblinGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GoblinGreen",{width:18,height:18,count:24},3,a,b),this.maxhp=80,this.hp=80,this.maxmp=0,this.mp=0,this._str=25,this._def=12,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=8,this.speed=2,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"刀",random:12},{itemName:"肉",random:5}]}})}(game),function(a){a.GoblinRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GoblinRed",{width:18,height:18,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.BatBlack=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("BatBlack",{width:30,height:28,count:24},3,a,b),this.maxhp=25,this.hp=25,this.maxmp=0,this.mp=0,this._str=13,this._def=4,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=2,this.speed=4,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"ダガー",random:6},{itemName:"肉",random:6},{itemName:"布の服",random:6}]}})}(game),function(a){a.BatGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("BatGreen",{width:30,height:28,count:24},3,a,b),this.maxhp=70,this.hp=70,this.maxmp=0,this.mp=0,this._str=24,this._def=18,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=8,this.speed=4,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"刀",random:8}]}})}(game),function(a){a.BatBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("BatBlue",{width:30,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.BatRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("BatRed",{width:30,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.BatWhite=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("BatWhite",{width:30,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.SkeltonNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SkeltonNormal",{width:16,height:20,count:24},3,a,b),this.maxhp=40,this.hp=40,this.maxmp=0,this.mp=0,this._str=18,this._def=6,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=3,this.speed=2,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"カッター",random:13},{itemName:"ジャンビーヤ",random:15},{itemName:"シャムシール",random:20},{itemName:"布の鎧",random:10}]}})}(game),function(a){a.SkeltonGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SkeltonGreen",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.SkeltonBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SkeltonBlue",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.SkeltonRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("SkeltonRed",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.HarypyNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("HarypyNormal",{width:24,height:26,count:24},3,a,b),this.maxhp=50,this.hp=50,this.maxmp=0,this.mp=0,this._str=15,this._def=8,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=4,this.speed=4,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"レイピア",random:10},{itemName:"布の鎧",random:6}]}})}(game),function(a){a.LizardManNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("LizardManNormal",{width:20,height:18,count:24},3,a,b),this.maxhp=60,this.hp=60,this.maxmp=0,this.mp=0,this._str=22,this._def=12,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=5,this.speed=3,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"刀",random:7},{itemName:"肉",random:5},{itemName:"革の鎧",random:5}]}})}(game),function(a){a.LizardManBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("LizardManBlue",{width:20,height:18,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.LizardManRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("LizardManRed",{width:20,height:18,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.ZombieNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("ZombieNormal",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.ZombieRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("ZombieRed",{width:16,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GolemNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GolemNormal",{width:22,height:26,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GolemGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GolemGreen",{width:22,height:26,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GolemBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GolemBlue",{width:18,height:18,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GolemRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GolemRed",{width:22,height:26,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GolemGhost=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GolemGhost",{width:22,height:26,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GhostNormal=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GhostNormal",{width:18,height:20,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GargoyleBlack=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GargoyleBlack",{width:40,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.GargoyleRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("GargoyleRed",{width:40,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.DragonGreen=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonGreen",{width:38,height:30,count:24},3,a,b),this.maxhp=260,this.hp=260,this.maxmp=0,this.mp=0,this._str=35,this._def=30,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=15,this.speed=2,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemName:"ドラゴンの爪(緑)",random:12},{itemName:"ドラゴンの鱗鎧(緑)",random:6}]}})}(game),function(a){a.DragonBlue=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonBlue",{width:30,height:28,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.DragonRed=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonRed",{width:38,height:30,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.DragonBlack=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonBlack",{width:38,height:30,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.DragonWhite=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonWhite",{width:38,height:30,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.DragonGhost=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("DragonGhost",{width:38,height:30,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){a.Death=tm.createClass({superClass:a.Enemy,init:function(a,b){this.superInit("Death",{width:24,height:30,count:24},3,a,b),this.maxhp=5,this.hp=5,this.maxmp=0,this.mp=0,this._str=3,this._def=0,this._agi=0,this._luk=0,this._vit=0,this._dex=0,this.exp=500,this.speed=1,this.velocity=tm.geom.Vector2(0,0),this.dropItemList=[{itemNum:1,random:2}]}})}(game),function(a){var b={item:[{name:"ダガー",type:"shortsword",summary:"両刃の短刀。",dropImage:"dropWeapon",status:{dis:1,str:2,def:0,agi:1,luk:0,vit:0,dex:0}},{name:"ナイフ",type:"shortsword",summary:"片刃の短刀。多目的に使用する。",dropImage:"dropWeapon",status:{dis:1,str:1,def:0,agi:2,luk:0,vit:0,dex:0}},{name:"ジャンビーヤ",type:"shortsword",summary:"刀身が湾曲しており、刀身の幅が広い。",dropImage:"dropWeapon",status:{dis:1,str:5,def:0,agi:3,luk:0,vit:0,dex:0}},{name:"パリングダガー",type:"shortsword",summary:"受け流し用の短剣",dropImage:"dropWeapon",status:{dis:1,str:3,def:2,agi:2,luk:0,vit:0,dex:0}},{name:"ドラゴンの爪(緑)",type:"shortsword",summary:"ドラゴンの爪は鋭く、鉄より硬い。",dropImage:"dropWeapon",status:{dis:1,str:15,def:0,agi:4,luk:0,vit:0,dex:0}},{name:"サーベル",type:"longsword",summary:"金属を打っただけの直刀。",dropImage:"dropWeapon",status:{dis:2.5,str:10,def:0,agi:-2,luk:0,vit:0,dex:0}},{name:"カッター",type:"longsword",summary:"片刃の直刀。",dropImage:"dropWeapon",status:{dis:2.5,str:15,def:0,agi:-2,luk:0,vit:0,dex:0}},{name:"レイピア",type:"longsword",summary:"刺突用の剣。",dropImage:"dropWeapon",status:{dis:2.5,str:4,def:0,agi:0,luk:0,vit:0,dex:0}},{name:"シャムシール",type:"longsword",summary:"曲刀。別名、三日月刀。",dropImage:"dropWeapon",status:{dis:2.5,str:22,def:0,agi:-2,luk:0,vit:0,dex:0}},{name:"刀",type:"longsword",summary:"東洋の直刀。",dropImage:"dropWeapon",status:{dis:2.5,str:36,def:0,agi:-4,luk:0,vit:0,dex:0}},{name:"布の服",type:"cloths",summary:"布でできた服。生地は薄い。",dropImage:"dropWeapon",status:{str:0,def:1,agi:0,luk:0,vit:0,dex:0}},{name:"布の鎧",type:"lightarmor",summary:"布を厚く縫い込んだ軽鎧。",dropImage:"dropWeapon",status:{str:0,def:3,agi:-1,luk:0,vit:0,dex:0}},{name:"革の鎧",type:"lightarmor",summary:"動物の革を縫い込んだ軽鎧。",dropImage:"dropWeapon",status:{str:0,def:7,agi:-1,luk:0,vit:0,dex:0}},{name:"鱗鎧",type:"lightarmor",summary:"動物の鱗を縫い込んだ軽鎧。",dropImage:"dropWeapon",status:{str:0,def:12,agi:-1,luk:0,vit:0,dex:0}},{name:"ドラゴンの鱗鎧(緑)",type:"lightarmor",summary:"ドラゴンの鱗を縫い込んだ軽鎧。とても軽い",dropImage:"dropWeapon",status:{str:1,def:15,agi:1,luk:0,vit:0,dex:0}},{name:"雑草",type:"medicine",summary:"食べられそうな草。",dropImage:"dropWeapon",status:{hp:2}},{name:"薬草",type:"medicine",summary:"滋養強壮に。",dropImage:"dropWeapon",status:{hp:7}},{name:"肉",type:"medicine",summary:"謎肉。",dropImage:"dropWeapon",status:{hp:10}},{name:"モンスターの液体",type:"medicine",summary:"不思議な色をしている。たまに動く。",dropImage:"dropWeapon",status:{hp:10}},{name:"ポーション",type:"medicine",summary:"薬草を調合した飲み物。",dropImage:"dropWeapon",status:{hp:30}}]};a.ItemList=tm.createClass({superClass:tm.app.CanvasElement,init:function(){this.superInit(),this.fromJSON(b)},get:function(a){if(null!==a)for(var b=0;b<this.item.length;++b)if(this.item[b].name===a)return this.item[b];return null}})}(game),function(a){var b=32,c=128,d=1,e=4,f=4;a.DropItem=tm.createClass({superClass:tm.app.AnimationSprite,init:function(a,g,h){var i={width:b/d,height:c/e,count:f};this.item=a;var h=h||3,j=tm.app.SpriteSheet({image:g||"dropTreasure",frame:i,animations:{open:[0,3,"opened",5],opened:[3,4,"opened",5]}});this.superInit(j,i.width*h,i.height*h),this.addEventListener("animationend",function(){this.paused=!0,this.tweener.to({alpha:0},700).call(function(){this.remove()}.bind(this))}),this.isRemove=!1},isHit:function(a){return this.isHitElementCircle(a)&&this.isRemove===!1?(this.isRemove=!0,this.gotoAndPlay("open"),this.item):null},update:function(){}})}(game),function(a){var b=25,c=a.SCREEN_WIDTH-2*b,d=a.SCREEN_HEIGHT-100,e=50,f=a.SCREEN_WIDTH/2,g=e+d/2,h=f-c/2,i=g-d/2,j=15,k=130,l=50,m=a.SCREEN_WIDTH-b-k/2-j,n=e+l/2+j,o=-d/2+(j+l)+l,p=60,q=45,r=240,s=170,t={LABELS:{children:[{type:"Label",name:"statusLevel",x:p,y:o,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusHP",x:p,y:o+1*q,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusEXP",x:p,y:o+2*q,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusSTR",x:p,y:o+3*q,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusDEF",x:p,y:o+4*q,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusAGI",x:p,y:o+5*q,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"}]}};a.Status=tm.createClass({superClass:tm.app.Shape,init:function(b){this.superInit(a.SCREEN_WIDTH,a.SCREEN_HEIGHT),this.setPosition(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT/2),this.backgroundColor="rgba(0, 0, 0, 0.0)",this.alpha=1,this.interaction.enabled=!0,this.interaction.boundingType="rect",this._refresh(),this.player=b.player;var c=a.iPhoneBlueButton(k,l,"終了");c.position.set(m,n),this.endButton=c,c.addEventListener("pointingend",function(a){a.app.popScene()});var d=a.Face(b);d.position.set(s,r);var e=this.player.getWeapon()?this.player.getWeapon().name:"装備無し",f=tm.app.GlossyButton(280,60,"gray",e);f.setPosition(200,500),this.weaponButton=f,this.weaponButton.addEventListener("pointingend",function(c){for(var d=[{text:"装備無し",subData:{dropImage:null,name:"装備無し",status:{dis:0,str:0,def:0,agi:0,luk:0,vit:0,dex:0}}}],e=0;e<b.player.getItem().length;++e){var f=b.player.getItem()[e].type;if("shortsword"===f||"longsword"===f){var g={text:b.player.getItem()[e].name,subData:b.player.getItem()[e]};d.push(g)}}c.app.pushScene(a.iPhonePicker(this,d))});var g=this.player.getArmor()?this.player.getArmor().name:"装備無し",h=tm.app.GlossyButton(280,60,"gray",g);h.setPosition(200,580),this.armorButton=h,this.armorButton.addEventListener("pointingend",function(c){for(var d=[{text:"装備無し",subData:{dropImage:null,name:"装備無し",status:{str:0,def:0,agi:0,luk:0,vit:0,dex:0}}}],e=0;e<b.player.getItem().length;++e){var f=b.player.getItem()[e].type;if("cloths"===f||"lightarmor"===f){var g={text:b.player.getItem()[e].name,subData:b.player.getItem()[e]};d.push(g)}}c.app.pushScene(a.iPhonePicker(this,d))});var i="使用するアイテムを選択",j=tm.app.GlossyButton(280,60,"gray",i);j.setPosition(200,660),this.medicineButton=j,this.medicineButton.addEventListener("pointingend",function(c){for(var d=[{text:"使用アイテムを選択",subData:{dropImage:null,name:"使用アイテムを選択",status:{hp:0}}}],e=0;e<b.player.getItem().length;++e){var f=b.player.getItem()[e].type;if("medicine"===f){var g={text:b.player.getItem()[e].name,subData:b.player.getItem()[e]};d.push(g)}}c.app.pushScene(a.iPhonePicker(this,d))}),b.addChild(this),b.addChild(c),b.addChild(f),b.addChild(h),b.addChild(j),b.addChild(d),this.fromJSON(t.LABELS),this._drawStatus()},_drawStatus:function(){this.statusLevel.text="Lv."+this.player.getLevel(),this.statusEXP.text="EXP "+this.player.getEXP()+"/"+this.player.getNextLevel(),this.statusHP.text="HP "+this.player.getCurrentHP()+"/"+this.player.getMaxHP(),this.statusSTR.text="攻撃力　"+this.player.getSTR()+" + "+(this.player.getWeapon().status.str+this.player.getArmor().status.str),this.statusDEF.text="防御力　"+this.player.getDEF()+" + "+(this.player.getWeapon().status.def+this.player.getArmor().status.def),this.statusAGI.text="速度   "+this.player.getAGI()+" + "+(this.player.getWeapon().status.agi+this.player.getArmor().status.agi)},_refresh:function(){var a=2,b=this.canvas;b.resize(this.width,this.height),b.globalCompositeOperation="lighter",this._shineStroke(b,a,a+h,a+i,190,80,30,a/2),b.globalCompositeOperation="source-over",b.fillStyle="rgba(5,25,60,0.5)",b.fillRoundRect(a+h,a+i,c,d,2*a)},_strokeRefresh:function(a,b,e,f,g,h){h=h||0,a.strokeStyle=g,a.lineWidth=b,a.fillStyle=g,0===h?(a.strokeStyle+=b/2,a.strokeRect(e,f,c-2*e,d-2*f)):a.strokeRoundRect(e,f,c,d,2*b)},_shineStroke:function(a,b,c,d,e,f,g,h){for(var i=tm.graphics.Color.createStyleHSL(e,f-50,g+50),j=tm.graphics.Color.createStyleHSL(e,f,g),k=0;12>k;++k)a.setShadow(j,0,0,40),this._strokeRefresh(a,b,c,d,i,h)},update:function(){if(this.weaponButton.returnedData&&(this.player.equipWeapon(this.weaponButton.returnedData),this._drawStatus(),this.weaponButton.returnedData=null),this.armorButton.returnedData&&(this.player.equipArmor(this.armorButton.returnedData),this._drawStatus(),this.armorButton.returnedData=null),this.medicineButton.returnedData){this.player.eatMedicine(this.medicineButton.returnedData);for(var a=0,b=0;b<this.player.getItem().length;++b){var c=this.player.getItem()[b].type;"medicine"===c&&(++a,a===this.medicineButton.ite&&this.player.deleteItem(b))}this._drawStatus(),this.medicineButton.returnedData=null}}}),a.Status.OUT_STROKE_COLOR="rgba(255, 255, 255, 1.0)",a.Status.IN_STROKE_COLOR="rgba(255, 0, 0, 1.0)",a.Status.BACK_GRADIENT_COLOR_TOP="rgba(120, 160, 245, 0.5)",a.Status.BACK_GRADIENT_COLOR_CENTER="rgba(55, 120, 220, 0.5)",a.Status.BACK_GRADIENT_COLOR_BOTTOM="rgba(35, 95, 220, 0.5)"}(game),function(a){a.Face=tm.createClass({superClass:tm.app.Shape,init:function(){this.superInit(220,220),this.backgroundColor="rgba(255, 255, 255, 0.5)",this._refresh();var a=tm.app.Sprite("playerFace",192,192);a.position.set(0,0),this.addChild(a)},_refresh:function(){var a=this.canvas;a.resize(this.width,this.height),a.fillStyle=this.backgroundColor,a.fillRoundRect(2,2,this.width-4,this.height-4,10),a.strokeStyle="rgba(255,255,255,0.75)",a.lineWidth=2,a.strokeRoundRect(2,2,this.width-4,this.height-4,10)}})}(game),function(a){var b=[[{enemy:a.SlimeGreen,num:15}],[{enemy:a.SlimeGreen,num:20},{enemy:a.SmallBatBlack,num:5}],[{enemy:a.SlimeGreen,num:15},{enemy:a.SmallBatBlack,num:10}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:15},{enemy:a.GoblinGrey,num:5}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:15}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:5}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:10}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:10}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:5}],[{enemy:a.SlimeGreen,num:10},{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:5}],[{enemy:a.SmallBatBlack,num:10},{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:10},{enemy:a.SkeltonNormal,num:5}],[{enemy:a.GoblinGrey,num:10},{enemy:a.BatBlack,num:15},{enemy:a.SkeltonNormal,num:10}],[{enemy:a.GoblinGrey,num:5},{enemy:a.BatBlack,num:10},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10}],[{enemy:a.GoblinGrey,num:5},{enemy:a.BatBlack,num:10},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10}],[{enemy:a.GoblinGrey,num:5},{enemy:a.BatBlack,num:5},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:10}],[{enemy:a.BatBlack,num:5},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:15}],[{enemy:a.BatBlack,num:5},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:15}],[{enemy:a.BatBlack,num:5},{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:15}],[{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:15},{enemy:a.LizardManNormal,num:5}],[{enemy:a.SkeltonNormal,num:10},{enemy:a.SlimeBlue,num:10},{enemy:a.HarypyNormal,num:15},{enemy:a.LizardManNormal,num:5}],[{enemy:a.HarypyNormal,num:15},{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10}],[{enemy:a.HarypyNormal,num:10},{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10}],[{enemy:a.HarypyNormal,num:10},{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10}],[{enemy:a.HarypyNormal,num:10},{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10}],[{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10},{enemy:a.SlimeRed,num:10}],[{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10},{enemy:a.SlimeRed,num:10}],[{enemy:a.LizardManNormal,num:5},{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10},{enemy:a.SlimeRed,num:10}],[{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10},{enemy:a.SlimeRed,num:15}],[{enemy:a.SmallBatGreen,num:10},{enemy:a.GoblinGreen,num:10},{enemy:a.BatGreen,num:10},{enemy:a.SlimeRed,num:15}],[{enemy:a.GoblinGreen,num:5},{enemy:a.BatGreen,num:5},{enemy:a.SlimeRed,num:10},{enemy:a.DragonGreen,num:20}]];a.StageManager=tm.createClass({init:function(a,c,d,e){if(this._isGameClear=!1,b.length<a)this._isGameClear=!0;else for(var f=0;f<b[a-1].length;++f){var g=b[a-1][f];this._createEnemy(c,d,e,g.enemy,g.num)}},isGameClear:function(){return this._isGameClear},_createEnemy:function(a,b,c,d,e){for(var f=0;e>f;++f){var g=d(b,c),h=c.getRandomSafeMapChipPosition();h=c.mapLeftTopToMapCenter(h.x*c.mapChipWidth+c.mapChipWidth/2,h.y*c.mapChipHeight),g.position.set(h.x,h.y),a.addChild(g)}}})}(game),function(a){var b={width:465,height:465};a.BarLoadingScene=tm.createClass({superClass:tm.app.Scene,init:function(c){this.superInit(),c={}.$extend(b,c),this.loadedCounter=0;var d=0;for(var e in c.assets)++d;this.planLoadNum=d,this.barUnit=100/d;var f=a.ProgressBar(a.SCREEN_WIDTH-100,25);f.setPosition(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT-90),f.setBarLength(0),this.bar=f,this.addChild(f),this.alpha=0,this.tweener.clear().fadeIn(100).call(function(){c.assets&&(tm.asset.AssetManager.onload=function(){this.tweener.clear().fadeOut(200).call(function(){this.app.replaceScene(c.nextScene())}.bind(this))}.bind(this),this.assets=tm.asset.AssetManager.load(c.assets),this.loadedCounter=this.assets._loadedCounter)}.bind(this))},update:function(){this.assets&&this.bar.setBarLength((this.assets._loadedCounter-this.loadedCounter)*this.barUnit)}})}(game),function(a){var b={width:465,height:465};a.EffectLoadingScene=tm.createClass({superClass:tm.app.Scene,init:function(c){this.superInit(),c={}.$extend(b,c),this.loadedCounter=0;var d=0;for(var e in c.assets)++d;this.planLoadNum=d,this.barUnit=100/d;var f=a.ProgressBar(a.SCREEN_WIDTH-250,25);f.setPosition(a.SCREEN_WIDTH/2-50,a.SCREEN_HEIGHT-90),f.setBarLength(0),this.bar=f,this.addChild(f);var g=tm.app.SpriteSheet({image:"loading",frame:{width:128,height:128,count:30},animations:{load:[0,30,"load"]}}),h=tm.app.AnimationSprite(g,256,256);h.position.set(a.SCREEN_WIDTH-100,a.SCREEN_HEIGHT-100),this.addChild(h),h.gotoAndPlay("load"),this.alpha=0,this.tweener.clear().fadeIn(100).call(function(){c.assets&&(tm.asset.AssetManager.onload=function(){this.tweener.clear().fadeOut(200).call(function(){this.app.replaceScene(c.nextScene())}.bind(this))}.bind(this),this.assets=tm.asset.AssetManager.load(c.assets),this.loadedCounter=this.assets._loadedCounter)}.bind(this))},update:function(){this.assets&&this.bar.setBarLength((this.assets._loadedCounter-this.loadedCounter)*this.barUnit)}})}(game),function(a){a.TitleScene=tm.createClass({superClass:tm.app.TitleScene,init:function(){this.superInit({title:"RoguePlus",width:a.SCREEN_WIDTH,height:a.SCREEN_HEIGHT}),this.addEventListener("pointingend",function(b){var c=a.EffectLoadingScene({width:b.app.width,height:b.app.height,assets:MAIN_ASSET,nextScene:a.MainScene});b.app.replaceScene(c)})}})}(game),function(a){var b={LABELS:{children:[{type:"Label",name:"stairsNum",x:100,y:80,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"right"},{type:"Label",name:"statusLevel",x:130,y:80,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusHP",x:230,y:80,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"},{type:"Label",name:"statusMP",x:430,y:80,width:a.SCREEN_WIDTH,fillStyle:"white",text:" ",fontSize:25,align:"left"}]}};a.MainScene=tm.createClass({superClass:tm.app.Scene,init:function(c,d){this.superInit();var e=d||tm.app.Pad();this.pad=e,e.position.set(100,a.SCREEN_HEIGHT-80);var f=c||a.Player(e);this.player=f,f.setInputPad(e),f.position.set(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT/2);var g=this._loadSaveData();if(g&&!c&&!d){var h=g.saveData.player;a.MainScene.STAGE_NUMBER=g.saveData.stairs,f.dataLoad(h)}var i=a.Map(e);this.map=i;var j=i.getRandomSafeMapChipPosition();j=i.mapLeftTopToMapCenter(j.x*i.mapChipWidth+i.mapChipWidth/2,j.y*i.mapChipHeight),j.x=a.SCREEN_WIDTH/2-j.x,j.y=a.SCREEN_HEIGHT/2-j.y,i.setStairs(),i.initMapPosition(j),i.setPlayer(j);var k=a.ItemList(),l=tm.app.CanvasElement();this.itemGroup=l,i.setItemGroup(l);var m=tm.app.CanvasElement();this.enemyGroup=m,this.stage=a.StageManager(a.MainScene.STAGE_NUMBER,m,f,i),i.setEnemyGroup(m);var n=tm.app.SpriteSheet({image:"slash",frame:{width:65,height:65,count:8},animations:{slash:[0,8]}}),o=tm.app.AnimationSprite(n,120,120);o.position.set(a.SCREEN_WIDTH/2+10,a.SCREEN_HEIGHT/2+10);var p=tm.app.SpriteSheet({image:"enemydead",frame:{width:64,height:64,count:40},animations:{enemydead:[0,40]}}),q=tm.app.Sprite("attackIcon",72,72),r=a.GlossyImageButton(200,160,q,"green");r.position.set(a.SCREEN_WIDTH-50-50,a.SCREEN_HEIGHT-30-50),this.attackButton=r;var s=a.Timing(150);this.attackTiming=s;var t=function(b){if(s.resetLimit(f.getAttackSpeed(b.fps)),s.is()!==!1){s.reset();var c=f.attack(),d=tm.geom.Vector2(0,0).setDegree(c,1);d.y*=-1;var e=50+20*f.getDistanse(),g=f.position.clone().add(tm.geom.Vector2.mul(d,e));o.position.set(g.x,g.y),o.gotoAndPlay("slash");var h=i.playerPosition.clone().add(tm.geom.Vector2.mul(d,e));h=i.mapLeftTopToMapCenter(h.x,h.y-20);var j=tm.app.Object2D();j.radius=20,j.position.set(h.x,h.y);for(var l=0;l<m.children.length;++l){var n=m.children[l];if(n.position.clone(),n.isHitElementCircle(j)){var q=f.getAttackPoint(),r=n.damage(q),t=a.DamagedNumber(r),u=n.getExp();f.addExp(u,b);var v=k.get(n.getDropItem());if(null!==v){var w=a.DropItem(v);w.position.set(n.x,n.y),i.addItem(w)}if(n.isEnemyDead()){var x=tm.app.AnimationSprite(p,120,120);x.position.set(n.x,n.y),i.setEnemyDeadAnimation(x),x.gotoAndPlay("enemydead")}var y=i.mapCenterToScreenTopLeft(n.x,n.y);t.effectPositionSet(y.x+10,y.y+5),b.currentScene.addChild(t)}}}};this.attackMethod=t,r.addEventListener("pointingmove",function(a){t(a.app)});var u=tm.app.Sprite("statusIcon",72,72),v=a.GlossyImageButton(200,160,u,"blue");v.position.set(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT-30-50),this.statusButton=v,v.addEventListener("pointingend",function(b){tm.asset.AssetManager.get("openstatus").clone().play(),b.app.pushScene(a.StatusScene(f))}),this.addChild(i),this.windows=a.ManageSimpleWindows(this),this.addChild(e),this.addChild(f),this.addChild(o),this.addChild(r),this.addChild(v),this.bgm=tm.asset.AssetManager.get("dungeon"),this.bgm.loop=!0,this.bgm.play(),this.fromJSON(b.LABELS)},screenLeftTopToCenter:function(b,c){var d=tm.geom.Vector2(b-a.SCREEN_WIDTH/2,c-a.SCREEN_HEIGHT/2);return d},screenCenterToLeftTop:function(b,c){var d=tm.geom.Vector2(b+a.SCREEN_WIDTH/2,c+a.SCREEN_HEIGHT/2);
return d},drawStatus:function(){this.stairsNum.text=a.MainScene.STAGE_NUMBER+"階",this.statusLevel.text="Lv."+this.player.getLevel(),this.statusHP.text="HP "+this.player.getCurrentHP()+"/"+this.player.getMaxHP()},update:function(b){this.attackTiming.update(),this.drawStatus(),b.keyboard.getKey("z")&&(this.attackTiming,this.attackMethod(b)),this.map.isNextStage()&&(++a.MainScene.STAGE_NUMBER,this.bgm.stop(),tm.asset.AssetManager.get("downStairs").clone().play(),this._autoSave(),b.replaceScene(a.MainScene(this.player,this.pad))),this.player.isGameOver()&&(this.bgm.stop(),this._deleteSaveData(),b.replaceScene(a.EndScene(a.MainScene.STAGE_NUMBER,this.player.getLevel(),!1))),this.stage.isGameClear()&&(this.bgm.stop(),this._deleteSaveData(),tm.asset.AssetManager.get("levelup").clone().play(),b.replaceScene(a.EndScene(a.MainScene.STAGE_NUMBER,this.player.getLevel(),!0)))},_autoSave:function(){var b={player:this.player.cloneToSave(),stairs:a.MainScene.STAGE_NUMBER},c=new Date,d=c.format("Y/m/d"),e=c.format("Y"),f=c.format("m"),g=c.format("d"),h={date:{all:d,year:e,month:f,day:g},saveData:b};localStorage.RoguePlus=JSON.stringify(h)},_loadSaveData:function(){var a=localStorage.RoguePlus;return a?JSON.parse(a):null},_deleteSaveData:function(){localStorage.removeItem("RoguePlus")}}),a.MainScene.STAGE_NUMBER=1}(game),function(a){a.StatusScene=tm.createClass({superClass:tm.app.Scene,init:function(b){this.superInit(),this.player=b;var c=tm.app.Shape(a.SCREEN_WIDTH,a.SCREEN_HEIGHT);c.setPosition(a.SCREEN_WIDTH/2,a.SCREEN_HEIGHT/2),c.canvas.clearColor("rgba(0, 0, 0, 0.75)"),this.addChild(c);var d=a.Status(this);this.status=d},update:function(){}})}(game),function(a){var b={score:256,msg:"【Rogue+】",hashtags:["omatoro","Rogue","tmlib"],url:"http://omatoro.github.io/RoguePlus",width:a.SCREEN_WIDTH,height:a.SCREEN_HEIGHT,related:"tmlib.js javascript testcording"};a.EndScene=tm.createClass({superClass:tm.app.ResultScene,title_button:{},init:function(a,c,d){b.score=d?"全"+(a-1)+"階制覇しました":a+"階で死亡しました",this.superInit(b)},update:function(){},onnextscene:function(){a.app.replaceScene(a.TitleScene()),a.MainScene.STAGE_NUMBER=1}})}(game),function(a){tm.main(function(){a.app=tm.app.CanvasApp("#world"),a.app.resize(a.SCREEN_WIDTH,a.SCREEN_HEIGHT),a.app.fitWindow(),a.app.background="rgb(0, 0, 0)","true"==a.QUERY_PARAM.stats&&a.app.enableStats();var b=a[a.QUERY_PARAM.scene]||a.TitleScene,c=ASSET_MAP[a.QUERY_PARAM.scene]||TITLE_ASSETS,d=a.BarLoadingScene({width:a.app.width,height:a.app.height,assets:c,nextScene:b});a.app.replaceScene(d),a.app.run()})}(game);